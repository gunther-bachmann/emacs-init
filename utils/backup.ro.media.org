#+title: backup read only meda
* backup ro media data (temp/music)
  #+begin_src sh :comments link :shebang "#!/usr/bin/env bash" :eval no :tangle ~/bin/backup.ro.media.sh :tangle-mode (identity #o755)
    #------------------------------------------------------------------
    # THIS FILE IS GENERATED (To edit please open file from link above)
    #------------------------------------------------------------------
    echo -e "Util to rsync read only data to mount (if present)\n"

    MOUNT_NAME="60a68d4f-b024-4f57-959a-7f3c91ebfa2d"

    function execute_ro_backup () {
      # $1 = folder
      TARGET="/run/media/$USER/$MOUNT_NAME/backup-media$1"
      if [[ -d $TARGET  &&  -d $HOME$1 ]]; then
        echo "Source and Target found, ready to backup $1 (c-c to stop)"
        CMD="rsync -h -a -P $HOME$1 $TARGET"
        echo "running '$CMD'"
        read -p "Are you sure (y)? " -r
        if [[ ! $REPLY =~ ^[Yy]$ ]]; then
          exit 1
        fi
        $CMD
        echo "done."
      else
        echo "Source or Target $TARGET not found"
      fi
    }

    if [ -d /run/media/$USER/$MOUNT_NAME/backup-media$FOLDER ]; then
      echo "Mount found, ready to backup $FOLDER (c-c to stop)"
      read -p "Are you sure (y)? " -r
      echo    # (optional) move to a new line
      if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
      fi

      execute_ro_backup "/temp/music"
      execute_ro_backup "/music"
    fi
  #+end_src
