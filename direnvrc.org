#+title: direnvrc
* header
  #+begin_src sh :comments link :eval no :tangle ~/.direnvrc
    #------------------------------------------------------------------
    # THIS FILE IS GENERATED (To edit please open file from link above)
    #------------------------------------------------------------------
  #+end_src
* export alias
  - since alias definitions in envrc are not put into the respective shell, an alternative is to create a shell script
    that behaves similar to an alias definition. this is done with this function.
  - it creates a shell script in the path with the given name, executing an arbitrary command sequence
  - example: ~export_alias zz "# do ls with -la as default parameter" "ls -la"~
    defines the alias (shell command) ~zz~ that will execute ~ls -la~ passing any additional parameters after ~-la~
    e.g.: ~zz *.bat~ will actually execute ~ls -la *.bat~
    additionally ~# do ls with -la as default parameter~ is defined as comment for this command (put into the second line of the shell script)
  #+begin_src sh :eval no :tangle ~/.direnvrc
    # work around to define aliases within .envrc
    # (see https://github.com/direnv/direnv/issues/73#issuecomment-174295790)
    #
    # example: export_alias zz "# do ls with -la as default parameter" "ls -la"
    #
    # usage:   zz        # will call the alias
    #          zz -1     # will call the alias and pass -h to the last command (i.e. ls)
    #          zz --help # will printout the description of this alias
    export_alias() {
      local name=$1
      shift
      local description=""
      if [[ $1 == \#* ]]; then
        description="$1"
        shift
      else
        description="# no description available"
      fi
      local PROJECT_DIR=$(expand_path .)
      local alias_dir=$PROJECT_DIR/.direnv/aliases
      local target="$alias_dir/$name"
      mkdir -p "$alias_dir"
      PATH_add "$alias_dir"
      echo "#! /usr/bin/env -S bash -e" > "$target"
      echo "$description" >> "$target"
      echo "{ if [ \"\$1\" == \"--help\" ]; then echo \"${description:2}\"; else $@ \$@; fi }" >> "$target"
      # echo "$@ \$@" >> "$target"
      chmod +x "$target"
    }
  #+end_src
* define standard alias
  - print out all defined aliases within this project
  #+begin_src sh :eval no :tangle ~/.direnvrc
    export_alias \? "# get info of all defined aliases" "for al in \$(ls -1 \${DIRENV_DIR:1}/.direnv/aliases); do echo -n \$al; echo -ne \"\\t\"; \$al --help; done;"
    alias a="?"
  #+end_src
* guix
  - allows for guix integration in ~.envrc~ to define a guix environment
    see [[https://direnv.net/man/direnv-stdlib.1.html#codeuse-guix-code][here]]
  - DEPRECATED example usage (for ebook decryption environment)
    #+begin_src sh :tangle no
      use_guix python2 \
        python2-cryptography \
        python2-pycrypto
    #+end_src
  - example usage (for ebook decryption environment) UNTESTED
    #+begin_src sh :tangle no
      use guix python2 \
        python2-cryptography \
        python2-pycrypto
    #+end_src
  - direnv now provides a command 'use guix' (supposed to use caching)
    it doesn't make use of guix time machine => use_guix is still useful (makes use of caching)
  #+begin_src sh :eval no :tangle ~/.direnvrc
    # allow for guix environment execution (e.g. 'use_guix guile', or 'use_guix racket@8.7')
    use_guix() {
      eval "$(guix time-machine --commit=0083a2265960f8228112c36e0d10eb974ff9d1f1 -- shell "$@" --search-paths)"
    }
  #+end_src
* nix
  - ideas to speed up, see https://github.com/direnv/direnv/wiki/Nix
